# –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó —á–µ—Ä–µ–∑ **Hikka** –¥–ª—è –≤–∞—à–æ–≥–æ –ø—Ä–æ—î–∫—Ç—É

–¶–µ–π –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—É—î, —è–∫ –ø—ñ–¥–∫–ª—é—á–∏—Ç–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—é –≤ –≤–∞—à –∑–∞—Å—Ç–æ—Å—É–Ω–æ–∫, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ **Hikka** —è–∫ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ —ñ–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—ñ (third-party login).

![–°—Ö–µ–º–∞](image.png)

---

## üß≠ –û–≥–ª—è–¥ –ø–æ—Ç–æ–∫—É

1. **–ö–ª—ñ—î–Ω—Ç—Å—å–∫–∏–π —Ä–µ–¥—ñ—Ä–µ–∫—Ç –Ω–∞ Hikka**
   –í–∏ —Ñ–æ—Ä–º—É—î—Ç–µ –ª—ñ–Ω–∫ –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫—É –∑–≥–æ–¥–∏ Hikka —ñ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—î—Ç–µ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.
2. **Hikka ‚Üí –≤–∞—à `redirect_uri`**
   –ü—ñ—Å–ª—è –∑–≥–æ–¥–∏ Hikka –≤–∏–∫–ª–∏–∫–∞—î –≤–∞—à `redirect_uri` —ñ –ø–µ—Ä–µ–¥–∞—î `reference` (alias `request_reference`) —É query.
3. **–û–±–º—ñ–Ω `reference` ‚Üí `secret`**
   –í–∞—à –±–µ–∫–µ–Ω–¥ –≤–∏–∫–ª–∏–∫–∞—î `POST /auth/token` –∑ `request_reference` —ñ –≤–∞—à–∏–º `client_secret`. –£ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –ø—Ä–∏—Ö–æ–¥–∏—Ç—å **—Å–µ–∫—Ä–µ—Ç** (third-party —Ç–æ–∫–µ–Ω).
4. **–û—Ç—Ä–∏–º–∞–Ω–Ω—è –ø—Ä–æ—Ñ—ñ–ª—é –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞**
   –î–∞–ª—ñ –≤–∏ –∑–≤–µ—Ä—Ç–∞—î—Ç–µ—Å—å –¥–æ `GET /user/me` –∑ –∑–∞–≥–æ–ª–æ–≤–∫–æ–º `Auth: <secret>` —ñ –æ—Ç—Ä–∏–º—É—î—Ç–µ –¥–∞–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.
5. **(–û–ø—Ü—ñ–π–Ω–æ) –≤—ñ–¥–∫–ª–∏–∫–∞–Ω–Ω—è —Ç–æ–∫–µ–Ω–∞**
   `DELETE /auth/token/{token_reference}`.

---

## üîë –¢–µ—Ä–º—ñ–Ω–∏

* **client\_reference** ‚Äî —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä –≤–∞—à–æ–≥–æ –∫–ª—ñ—î–Ω—Ç–∞ –≤ Hikka (–≤–∏–¥–∞—î—Ç—å—Å—è Hikka).
* **client\_secret** ‚Äî —Å–µ–∫—Ä–µ—Ç –≤–∞—à–æ–≥–æ –∫–ª—ñ—î–Ω—Ç–∞, **–∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ –Ω–∞ –±–µ–∫–µ–Ω–¥—ñ**.
* **reference / request\_reference** ‚Äî –∫–æ—Ä–æ—Ç–∫–æ—á–∞—Å–Ω–∏–π –∫–æ–¥, —è–∫–∏–π Hikka –ø–æ–≤–µ—Ä—Ç–∞—î –Ω–∞ –≤–∞—à `redirect_uri` –ø—ñ—Å–ª—è –∑–≥–æ–¥–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.
* **secret** ‚Äî —Ç–æ–∫–µ–Ω, —è–∫–∏–º –≤–∏ –ø—ñ–¥–ø–∏—Å—É—î—Ç–µ –∑–∞–ø–∏—Ç–∏ –¥–æ Hikka (–∑–∞–≥–æ–ª–æ–≤–æ–∫ `Auth: <secret>`).
* **token\_reference** ‚Äî —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä –≤–∏–¥–∞–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–∞ (–∑–Ω–∞–¥–æ–±–∏—Ç—å—Å—è –¥–ª—è –≤—ñ–¥–∫–ª–∏–∫–∞–Ω–Ω—è).

---

## üì¶ –ó–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ / –∑–º—ñ–Ω–Ω—ñ –æ—Ç–æ—á–µ–Ω–Ω—è

–ó—Ä—É—á–Ω–æ –ø–æ–∫–ª–∞—Å—Ç–∏ –∫–æ–Ω—Ñ—ñ–≥ —É –∑–º—ñ–Ω–Ω—ñ –æ—Ç–æ—á–µ–Ω–Ω—è:

```
HIKKA_CLIENT_REFERENCE=xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
HIKKA_CLIENT_SECRET=your_hikka_client_secret
```

–î–ª—è –ø—Ä–∏–∫–ª–∞–¥—ñ–≤ –Ω–∏–∂—á–µ –ø–æ—Ç—Ä—ñ–±–Ω–∞ –ª–∏—à–µ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ `requests`.

---

## üîó –ö—Ä–æ–∫ 1. –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ URL –∑–≥–æ–¥–∏

**–ï–Ω–¥–ø–æ—ñ–Ω—Ç (front):**

```
GET https://hikka.io/oauth
```

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ (—Ç–∏–ø–æ–≤—ñ):**

* `reference` ‚Äî –≤–∞—à `client_reference`
* `scope` ‚Äî –∫–æ–º–∞-—Å–µ–ø–∞—Ä–æ–≤–∞–Ω–∏–π —Å–ø–∏—Å–æ–∫ (–Ω–µ–æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–æ)

**–ü—Ä–∏–∫–ª–∞–¥ URL:**

```
https://hikka.io/oauth?client=YOUR_CLIENT_REFERENCE&scope=read:user-details,read:watchlist
```

---

## ‚Ü©Ô∏è –ö—Ä–æ–∫ 2. –ü—Ä–∏–π–Ω—è—Ç–∏ `reference`

–ü—ñ—Å–ª—è –∑–≥–æ–¥–∏ Hikka –≤–∏–∫–ª–∏—á–µ –≤–∞—à endpoint` –∑ query-–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º:

```
https://your.app/auth/hikka?reference=REQUEST_REFERENCE
```

–ó–±–µ—Ä–µ–∂—ñ—Ç—å `reference`.

---

## üîÅ –ö—Ä–æ–∫ 3. –û–±–º—ñ–Ω—è—Ç–∏ `reference` –Ω–∞ `secret`

**–ï–Ω–¥–ø–æ—ñ–Ω—Ç (API):**

```
POST https://api.hikka.io/auth/token
```

**–¢—ñ–ª–æ –∑–∞–ø–∏—Ç—É (JSON):**

```json
{
  "request_reference": "REQUEST_REFERENCE",
  "client_secret": "YOUR_CLIENT_SECRET"
}
```

**–û—á—ñ–∫—É–≤–∞–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å (–ø—Ä–∏–∫–ª–∞–¥):**

```json
{
  "secret": "SECRET_FOR_AUTH_HEADER",
  "token_reference": "tok_12345",
  "expires_in": 3600,
  "scope": "read:user-details,read:watchlist"
}
```

---

## üë§ –ö—Ä–æ–∫ 4. –û—Ç—Ä–∏–º–∞—Ç–∏ –ø—Ä–æ—Ñ—ñ–ª—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞

**–ï–Ω–¥–ø–æ—ñ–Ω—Ç (API):**

```
GET https://api.hikka.io/user/me
```

**–ó–∞–≥–æ–ª–æ–≤–æ–∫:**

```
Auth: SECRET_FOR_AUTH_HEADER
```

**–ü—Ä–∏–∫–ª–∞–¥ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ (—Ä–µ–∞–ª—å–Ω–∏–π –∑ –≤–∞—à–æ–≥–æ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞):**

```json
{
  "reference": "",
  "updated": 1756282464,
  "created": 1712125598,
  "description": null,
  "username": "",
  "cover": null,
  "active": true,
  "avatar": "https://cdn.hikka.io/avatar.jpg",
  "role": "user",
  "email": ""
}
```

> –ü–æ–ª—è –º–æ–∂—É—Ç—å –≤—ñ–¥—Ä—ñ–∑–Ω—è—Ç–∏—Å—è –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ —ñ–Ω—Å—Ç–∞–ª—è—Ü—ñ—ó Hikka —Ç–∞ –≤–∏–¥–∞–Ω–∏—Ö —Å–∫–æ—É–ø—ñ–≤.

---

## üß™ –ü—Ä–∏–∫–ª–∞–¥–∏ `curl`

**1) –û–±–º—ñ–Ω `reference` –Ω–∞ `secret`:**

```bash
curl -X POST https://api.hikka.io/auth/token \
  -H "Content-Type: application/json" \
  -d '{
    "request_reference": "REQUEST_REFERENCE",
    "client_secret": "YOUR_CLIENT_SECRET"
  }'
```

**2) –û—Ç—Ä–∏–º–∞—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞:**

```bash
curl -X GET https://api.hikka.io/user/me \
  -H "Auth: SECRET_FOR_AUTH_HEADER"
```

---

## üß© –ü—Ä–∏–∫–ª–∞–¥ –±–µ–∫–µ–Ω–¥—É (Python, sync)

```python
from api import HikkaOAuthClient
import uuid

client = HikkaOAuthClient(
    client_reference="YOUR_CLIENT_REFERENCE",
    client_secret="YOUR_CLIENT_SECRET",
    redirect_uri="https://your.app/auth/hikka",
)

# 1) —Ä–µ–¥—ñ—Ä–µ–∫—Ç–∏–º–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞:
state = uuid.uuid4().hex
consent_url = client.build_authorize_url(
    scopes=["read:user-details", "read:watchlist"],
    state=state,
)

# 2) –ø—Ä–∏–π–º–∞—î–º–æ ?reference=... –Ω–∞ /auth/hikka

# 3) –æ–±–º—ñ–Ω—é—î–º–æ reference –Ω–∞ secret:
token = client.exchange_request_reference(request_reference="<reference>")

# 4) —á–∏—Ç–∞—î–º–æ –ø—Ä–æ—Ñ—ñ–ª—å:
me = client.get_current_user(secret=token.secret)
```

---

## üö® –¢–∏–ø–æ–≤—ñ –ø–æ–º–∏–ª–∫–∏ —Ç–∞ –ø–æ—Ä–∞–¥–∏

* `400 {"message":"Auth token is missing","code":"auth:missing_token"}`

  * –í–∏ –∑–≤–µ—Ä—Ç–∞—î—Ç–µ—Å—å –¥–æ –µ–Ω–¥–ø–æ—ñ–Ω—Ç—É, —è–∫–∏–π –ø–æ—Ç—Ä–µ–±—É—î –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Auth`, –∞–±–æ –ø—Ä–æ–±—É—î—Ç–µ —Å—Ç–≤–æ—Ä–∏—Ç–∏ *request* –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.
    **–†—ñ—à–µ–Ω–Ω—è:** –Ω–µ –≤–∏–∫–ª–∏–∫–∞–π—Ç–µ `/auth/token/request/...` –∑—ñ —Å–≤–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞; Hikka —Å–∞–º–∞ –∑–≥–µ–Ω–µ—Ä—É—î `reference` –ø—ñ—Å–ª—è –∑–≥–æ–¥–∏ –Ω–∞ —Ñ—Ä–æ–Ω—Ç—ñ.

* `401 Unauthorized`

  * –ù–µ–≤—ñ—Ä–Ω–∏–π –∞–±–æ –ø—Ä–æ—Å—Ç—Ä–æ—á–µ–Ω–∏–π `secret`.
    **–†—ñ—à–µ–Ω–Ω—è:** –ø–æ–≤—Ç–æ—Ä—ñ—Ç—å –ø–æ—Ç—ñ–∫ –∑ —Ä–µ–¥—ñ—Ä–µ–∫—Ç–æ–º, –æ—Ç—Ä–∏–º–∞–π—Ç–µ –Ω–æ–≤–∏–π `secret`.


---

## üß± –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (–ø–æ—è—Å–Ω–µ–Ω–Ω—è –ø–æ–ª—ñ–≤)

* `reference` ‚Äî –≤–Ω—É—Ç—Ä—ñ—à–Ω—ñ–π ID –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —É Hikka.
* `created` / `updated` ‚Äî unix-–º—ñ—Ç–∫–∏ —á–∞—Å—É —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è/–æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∞–∫–∞—É–Ω—Ç–∞.
* `username` ‚Äî –Ω—ñ–∫–Ω–µ–π–º –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.
* `email` ‚Äî email .
* `role` ‚Äî —Ä–æ–ª—å —É —Å–∏—Å—Ç–µ–º—ñ (`user`,  —ñ–Ω—à—ñ).
* `active` ‚Äî —Å—Ç–∞—Ç—É—Å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –∞–∫–∞—É–Ω—Ç–∞.
* `avatar`, `cover`, `description` ‚Äî –ø—É–±–ª—ñ—á–Ω—ñ –ø–æ–ª—è –ø—Ä–æ—Ñ—ñ–ª—é.

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó

* [ ] –û—Ç—Ä–∏–º–∞–ª–∏ –≤—ñ–¥ Hikka `client_reference` —ñ `client_secret`.
* [ ] –î–æ–¥–∞–ª–∏ `redirect_uri` —É –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∫–ª—ñ—î–Ω—Ç–∞ –≤ Hikka.
* [ ] –†–µ–∞–ª—ñ–∑—É–≤–∞–ª–∏ –µ–Ω–¥–ø–æ—ñ–Ω—Ç **login** ‚Üí —Ä–µ–¥—ñ—Ä–µ–∫—Ç –Ω–∞ `hikka.io/oauth?...`.
* [ ] –†–µ–∞–ª—ñ–∑—É–≤–∞–ª–∏ **callback** (`redirect_uri`) ‚Üí –∑—á–∏—Ç—É—î `reference` + –ø–µ—Ä–µ–≤—ñ—Ä—è—î `state`.
* [ ] –û–±–º—ñ–Ω—è–ª–∏ `reference` –Ω–∞ `secret` (`POST /auth/token`).
* [ ] –í–∏—Ç—è–≥–Ω—É–ª–∏ –ø—Ä–æ—Ñ—ñ–ª—å (`GET /user/me` –∑ `Auth: secret`) —ñ —Å—Ç–≤–æ—Ä–∏–ª–∏/–æ–Ω–æ–≤–∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.
* [ ] (–û–ø—Ü—ñ–π–Ω–æ) –ó–±–µ—Ä—ñ–≥–∞—î–º–æ `token_reference` –¥–ª—è –º–æ–∂–ª–∏–≤–æ–≥–æ –≤—ñ–¥–∫–ª–∏–∫–∞–Ω–Ω—è.

---
